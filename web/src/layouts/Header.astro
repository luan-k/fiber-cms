---
import HeaderLink from "@/components/Header/HeaderLink.astro";
import { SITE_TITLE } from "@/consts";
---

<header>
  <nav>
    <h2><a href="/">{SITE_TITLE}</a></h2>
    <div class="internal-links">
      <HeaderLink href="/">Home</HeaderLink>
      <HeaderLink href="/posts">Posts</HeaderLink>
      <HeaderLink href="/users">Users</HeaderLink>
      <HeaderLink href="/about">About</HeaderLink>
      <HeaderLink href="/gl-admin" id="admin-link" style="display: none;">Admin</HeaderLink>
    </div>
    <div class="social-links">
      <a href="https://github.com/withastro/astro" target="_blank">
        <span class="sr-only">Go to Astro's GitHub repo</span>
        <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32"
          ><path
            fill="currentColor"
            d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"
          ></path></svg
        >
      </a>
      <div id="auth-section" class="auth-links">
        <button id="login-btn" class="auth-button">Login</button>
        <div id="user-menu" style="display: none;">
          <span id="user-name"></span>
          <button id="logout-btn" class="auth-button logout">Logout</button>
        </div>
      </div>
    </div>
  </nav>
</header>

<style>
  header {
    margin: 0;
    padding: 0 1em;
    background: white;
    box-shadow: 0 2px 8px rgba(var(--black), 5%);
  }
  h2 {
    margin: 0;
    font-size: 1em;
  }

  h2 a,
  h2 a.active {
    text-decoration: none;
  }
  nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 60px;
  }
  nav a {
    padding: 1em 0.5em;
    color: var(--black);
    border-bottom: 4px solid transparent;
    text-decoration: none;
  }
  nav a:hover,
  nav a.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
  }
  .social-links,
  .social-links a {
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  .auth-links {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  .auth-button {
    background: var(--accent);
    border: none;
    border-radius: 4px;
    color: white;
    cursor: pointer;
    font-size: 0.9rem;
    padding: 0.5rem 1rem;
    text-decoration: none;
    transition: background 0.2s ease;
  }
  .auth-button:hover {
    background: var(--accent-dark);
  }
  .auth-button.logout {
    background: rgb(var(--gray));
  }
  .auth-button.logout:hover {
    background: rgb(var(--gray-dark));
  }
  #user-menu {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  #user-name {
    color: rgb(var(--black));
    font-weight: 500;
  }
  @media (max-width: 720px) {
    .internal-links {
      display: none;
    }
  }
</style>

<script>
  import { authManager } from '../lib/auth';
  
  const loginBtn = document.getElementById('login-btn');
  const logoutBtn = document.getElementById('logout-btn');
  const userMenu = document.getElementById('user-menu');
  const userName = document.getElementById('user-name');
  const adminLink = document.getElementById('admin-link');
  
  function updateAuthUI() {
    const authState = authManager.getState();
    
    if (authState.isAuthenticated && authState.user) {
      loginBtn!.style.display = 'none';
      userMenu!.style.display = 'flex';
      userName!.textContent = authState.user.username;
      adminLink!.style.display = 'inline';
    } else {
      loginBtn!.style.display = 'inline-block';
      userMenu!.style.display = 'none';
      adminLink!.style.display = 'none';
    }
  }
  
  loginBtn?.addEventListener('click', () => {
    window.location.href = '/login';
  });
  
  logoutBtn?.addEventListener('click', async () => {
    await authManager.logout();
    updateAuthUI();
    window.location.href = '/';
  });
  
  updateAuthUI();
</script>